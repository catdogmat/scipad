<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sciPAD Answers</title>

    <!-- Adobe Fonts -->
    <link rel="stylesheet" href="https://use.typekit.net/ctk0oqa.css">

    <!-- Font Awesome for icons -->
    <script src="https://kit.fontawesome.com/635c80d725.js" crossorigin="anonymous"></script>

    <style>
        :root {
            --bg-color: #f4f4f9;
            --text-color: #333;
            --primary-color: #007bff;
            --card-bg: #ffffff;
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
        }

        body {
            font-family: 'proxima-nova', sans-serif;
            font-weight: 500;
            font-feature-settings: "ss04" on;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            padding-bottom: 80px;
            transition: background-color 0.5s ease;
        }

        #app {
            max-width: 900px;
            margin: 0 auto;
        }
        
        /* --- NEW HEADER STYLES --- */
        .app-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            min-height: 48px; /* Give it some space */
        }

        .header-split {
            justify-content: space-between;
        }

        .header-center {
            justify-content: center;
        }

        .logodiv a {
            text-decoration: none;
            color: inherit; /* Inherits color from parent */
        }
        
        .logo {
            transition: color 0.5s ease;
        }
        
        .logo-large {
            font-size: 2.5rem;
        }

        .logo-small {
            font-size: 1.5rem;
        }

        .l1 {
            font-weight: 900;
        }

        .l2 {
            font-weight: 500;
        }
        /* --- END HEADER STYLES --- */

        #error-container {
            background-color: #ffdddd;
            border-left: 6px solid #f44336;
            color: #333;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: var(--border-radius);
            font-size: 1.1em;
        }

        h1,
        h2 {
            text-align: center;
            color: var(--text-color);
            font-weight: 900;
        }

        .filters {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filters label {
            font-weight: 900;
        }

        .filters select {
            padding: 8px 12px;
            font-size: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid #ced4da;
            background-color: #fff;
            cursor: pointer;
            font-family: 'proxima-nova', sans-serif;
            font-weight: 500;
        }

        #results-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .category-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-decoration: none;
            color: var(--text-color);
            transition: transform 0.2s, box-shadow 0.2s;
            border-left: 5px solid;
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        .category-card h3 {
            margin: 0 0 10px 0;
            font-weight: 900;
        }

        .category-card p {
            margin: 0;
            color: #666;
            text-transform: capitalize;
        }

        .standards-list {
            list-style: none;
            padding: 0;
        }

        .standard-item a {
            display: block;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-decoration: none;
            font-weight: 900;
            font-size: 1.2em;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .standard-item a:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .back-link {
            display: inline-block;
            font-weight: 900;
            text-decoration: none;
        }

        #footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            background: whitesmoke;
            font-size: 0.8em;
            padding: 10px 0;
            box-shadow: 0 -2px 5px rgba(0,0,0,0.1);
            transition: background-color 0.5s ease;
        }
        #footer p {
            text-align: center;
            color: black;
            line-height: 1.5;
            margin: 0;
            padding: 0 15px;
            transition: color 0.5s ease;
        }
        #footer a {
            color: #007bff;
            transition: color 0.5s ease;
        }
    </style>
</head>

<body>
    <div id="app"></div>
    <div id="footer">
        <p>This site is not affiliated with
            Silverback Academic Media or the official Scipad books. We do not host or distribute Scipad content.
            Scipad is a registered trademark of Silverback Academic Media and is referenced here under fair use for
            identification purposes only. <a href="/about">Learn about our mission.</a></p>
    </div>

    <script>
        const app = document.getElementById('app');
        const footer = document.getElementById('footer');
        const footerText = footer.querySelector('p');
        const footerLink = footer.querySelector('a');

        async function fetchData() {
            try {
                const response = await fetch('data.json');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error("Error fetching data.json:", error);
                renderError("Could not load the necessary data. Please ensure 'data.json' is available.");
                return null;
            }
        }

        // --- COLOR ALGORITHM FUNCTIONS ---
        function getTextColorForBg(hex) {
            if (!hex) return '#333333';
            const r = parseInt(hex.substr(1, 2), 16);
            const g = parseInt(hex.substr(3, 2), 16);
            const b = parseInt(hex.substr(5, 2), 16);
            const yiq = ((r * 299) + (g * 587) + (b * 114)) / 1000;
            return (yiq >= 149) ? '#333333' : '#FFFFFF';
        }

        function hexToHsl(H) {
            let r = 0, g = 0, b = 0;
            if (H.length == 4) { r = "0x" + H[1] + H[1]; g = "0x" + H[2] + H[2]; b = "0x" + H[3] + H[3]; }
            else if (H.length == 7) { r = "0x" + H[1] + H[2]; g = "0x" + H[3] + H[4]; b = "0x" + H[5] + H[6]; }
            r /= 255; g /= 255; b /= 255;
            let cmin = Math.min(r, g, b), cmax = Math.max(r, g, b), delta = cmax - cmin, h = 0, s = 0, l = 0;
            if (delta == 0) h = 0;
            else if (cmax == r) h = ((g - b) / delta) % 6;
            else if (cmax == g) h = (b - r) / delta + 2;
            else h = (r - g) / delta + 4;
            h = Math.round(h * 60);
            if (h < 0) h += 360;
            l = (cmax + cmin) / 2;
            s = delta == 0 ? 0 : delta / (1 - Math.abs(2 * l - 1));
            s = +(s * 100).toFixed(1);
            l = +(l * 100).toFixed(1);
            return [h, s, l];
        }

        function hslToHex(h, s, l) {
            s /= 100; l /= 100;
            let c = (1 - Math.abs(2 * l - 1)) * s, x = c * (1 - Math.abs((h / 60) % 2 - 1)), m = l - c / 2, r = 0, g = 0, b = 0;
            if (0 <= h && h < 60) { r = c; g = x; b = 0; }
            else if (60 <= h && h < 120) { r = x; g = c; b = 0; }
            else if (120 <= h && h < 180) { r = 0; g = c; b = x; }
            else if (180 <= h && h < 240) { r = 0; g = x; b = c; }
            else if (240 <= h && h < 300) { r = x; g = 0; b = c; }
            else if (300 <= h && h < 360) { r = c; g = 0; b = x; }
            r = Math.round((r + m) * 255).toString(16);
            g = Math.round((g + m) * 255).toString(16);
            b = Math.round((b + m) * 255).toString(16);
            if (r.length == 1) r = "0" + r;
            if (g.length == 1) g = "0" + g;
            if (b.length == 1) b = "0" + b;
            return "#" + r + g + b;
        }

        function generateLinkColor(baseHex) {
            const [h, s, l] = hexToHsl(baseHex);
            const newHue = (h + 150) % 360;
            return hslToHex(newHue, 85, 55);
        }

        function renderError(message) {
            const errorContainer = document.createElement('div');
            errorContainer.id = 'error-container';
            errorContainer.innerHTML = `<p><strong>Error:</strong> ${message}</p>`;
            if (app.firstChild) app.insertBefore(errorContainer, app.firstChild);
            else app.appendChild(errorContainer);
        }

        function createLogo(sizeClass, color) {
            const logoDiv = document.createElement('div');
            logoDiv.className = 'logodiv';
            logoDiv.innerHTML = `<a href="/"><span class="l1 logo ${sizeClass}">sciPad</span><span class="l2 logo ${sizeClass}"> answers</span></a>`;
            logoDiv.style.color = color;
            return logoDiv;
        }

        function renderHomePage(data) {
            document.body.style.backgroundColor = 'var(--bg-color)';
            footer.style.backgroundColor = 'whitesmoke';
            footerText.style.color = 'black';
            footerLink.style.color = '#007bff';
            const existingError = document.getElementById('error-container');
            app.innerHTML = '';
            if (existingError) app.appendChild(existingError);

            // Create and append header
            const header = document.createElement('header');
            header.className = 'app-header header-center';
            header.appendChild(createLogo('logo-large', 'var(--text-color)'));
            app.appendChild(header);

            const filterContainer = document.createElement('div');
            filterContainer.className = 'filters';
            filterContainer.innerHTML = `
                <div class="filter-group">
                    <label for="subject-select">Subject:</label>
                    <select id="subject-select"></select>
                </div>
                <div class="filter-group">
                    <label for="level-select">Level:</label>
                    <select id="level-select"></select>
                </div>
            `;
            app.appendChild(filterContainer);
            const resultsContainer = document.createElement('div');
            resultsContainer.id = 'results-container';
            app.appendChild(resultsContainer);
            let activeFilters = { subject: 'All', year: 'All' };
            const allCategories = Object.values(data);
            const subjectSelect = document.getElementById('subject-select');
            const levelSelect = document.getElementById('level-select');
            function updateAndRender() {
                const availableBasedOnYear = allCategories.filter(cat => activeFilters.year === 'All' || cat.year === activeFilters.year);
                const availableBasedOnSubject = allCategories.filter(cat => activeFilters.subject === 'All' || cat.subject === activeFilters.subject);
                const availableSubjects = ['All', ...new Set(availableBasedOnYear.map(cat => cat.subject))];
                const uniqueLevels = [...new Set(availableBasedOnSubject.map(cat => cat.year))].sort();
                const availableLevels = ['All', ...uniqueLevels];
                populateSelect(subjectSelect, availableSubjects, activeFilters.subject);
                populateSelect(levelSelect, availableLevels, activeFilters.year);
                resultsContainer.innerHTML = '';
                Object.entries(data).forEach(([key, category]) => {
                    const subjectMatch = activeFilters.subject === 'All' || category.subject === activeFilters.subject;
                    const yearMatch = activeFilters.year === 'All' || category.year === activeFilters.year;
                    if (subjectMatch && yearMatch) {
                        const card = document.createElement('a');
                        card.href = `/${key}`;
                        card.className = 'category-card';
                        card.style.borderLeftColor = category.color;
                        card.innerHTML = `
                            <h3>${category.title}</h3>
                            <p>${category.subject} - Level ${category.year}</p>
                        `;
                        resultsContainer.appendChild(card);
                    }
                });
            }
            function populateSelect(selectElement, options, selectedValue) {
                const currentValue = selectElement.value;
                selectElement.innerHTML = '';
                options.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option;
                    optionElement.textContent = option;
                    selectElement.appendChild(optionElement);
                });
                if (options.includes(currentValue)) { selectElement.value = currentValue; }
                else { selectElement.value = selectedValue; }
            }
            subjectSelect.addEventListener('change', (e) => {
                activeFilters.subject = e.target.value;
                updateAndRender();
            });
            levelSelect.addEventListener('change', (e) => {
                activeFilters.year = e.target.value;
                updateAndRender();
            });
            updateAndRender();
        }

        function renderCategoryPage(categoryData) {
            const subjectColor = categoryData.color;
            const pageTextColor = getTextColorForBg(subjectColor);
            const linkColor = generateLinkColor(subjectColor);
            const cardAndFooterBg = (pageTextColor === '#FFFFFF') ? '#FFFFFF' : '#333333';

            document.body.style.backgroundColor = subjectColor;
            footer.style.backgroundColor = cardAndFooterBg;
            footerText.style.color = subjectColor;
            footerLink.style.color = linkColor;

            app.innerHTML = ''; // Clear app content

            // Create and append header
            const header = document.createElement('header');
            header.className = 'app-header header-split';
            const backLink = document.createElement('a');
            backLink.href = '/';
            backLink.className = 'back-link';
            backLink.textContent = '‹ Back to All Subjects';
            backLink.style.color = pageTextColor;
            header.appendChild(backLink);
            header.appendChild(createLogo('logo-small', pageTextColor));
            app.appendChild(header);

            // Append the rest of the content
            const contentDiv = document.createElement('div');
            contentDiv.innerHTML = `
                <h1 style="color: ${pageTextColor};">${categoryData.title}</h1>
                <ul class="standards-list">
                    ${categoryData.pages.map(page => `
                        <li class="standard-item">
                            <a href="${page.url}" target="_blank" rel="noopener noreferrer" style="background-color: ${cardAndFooterBg}; color: ${subjectColor};">${page.title}</a>
                        </li>
                    `).join('')}
                </ul>
            `;
            app.appendChild(contentDiv);
        }

        function handleStandardRedirect(path, data) {
            const parts = path.split('.');
            if (parts.length < 2) return false;
            const categoryKey = parts[0];
            const pageId = parts.slice(1).join('.');
            const category = data[categoryKey];
            if (category) {
                const page = category.pages.find(p => p.id.toUpperCase() === pageId);
                if (page) {
                    window.location.href = page.url;
                    return true;
                }
            }
            return false;
        }
        
        async function main() {
            const data = await fetchData();
            if (!data) return;
            const path = window.location.pathname.slice(1).toUpperCase();
            if (path.includes('.')) {
                if (handleStandardRedirect(path, data)) { return; }
                else {
                    renderError(`The standard '${path}' could not be found.`);
                    renderHomePage(data);
                    return;
                }
            }
            if (path === '') {
                renderHomePage(data);
                return;
            }
            if (data[path]) {
                renderCategoryPage(data[path]);
                return;
            }
            renderError(`The page or category '${path}' does not exist.`);
            renderHomePage(data);
        }

        main();
    </script>
</body>

</html>
