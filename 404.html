<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Textbook Router</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      color: #fff;
    }
    h1 {
      margin-bottom: 1rem;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      margin: 0.5rem 0;
    }
    a {
      color: #fff;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div id="app">Loading...</div>

  <script>
    async function init() {
      // strip slashes from start & end
      const path = window.location.pathname.replace(/^\/+|\/+$/g, "");
      
      // load JSON
      const res = await fetch("data.json"); // relative, so it works on GitHub Pages
      const data = await res.json();

      const app = document.getElementById("app");

      if (!path) {
        app.innerHTML = "<p>No subject chosen. Try /bc1, /c2, /pess1, /ess3</p>";
        return;
      }

      // check if path contains a dot
      if (path.includes(".")) {
        const [subjectKey, pageId] = path.split(".");
        const subject = data[subjectKey];
        if (subject) {
          const page = subject.pages.find(p => p.id === pageId);
          if (page) {
            window.location.href = page.url;
            return;
          }
        }
        app.innerHTML = "<p>Page not found.</p>";
        return;
      }

      // first-level subject page
      const subjectKey = path;
      const subject = data[subjectKey];

      if (!subject) {
        app.innerHTML = "<p>Unknown subject.</p>";
        return;
      }

      document.body.style.backgroundColor = subject.color;
      app.innerHTML = `
        <h1>${subject.title}</h1>
        <ul>
          ${subject.pages.map(p => `<li><a href="${subjectKey}.${p.id}">${p.title}</a></li>`).join("")}
        </ul>
      `;
    }

    init();
  </script>
</body>
</html>
