<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>sciPAD Answers</title>
    <style>
        :root {
            --bg-color: #f4f4f9;
            --text-color: #333;
            --primary-color: #007bff;
            --card-bg: #ffffff;
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            transition: background-color 0.5s ease;
        }

        #app {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Error Message */
        #error-container {
            background-color: #ffdddd;
            border-left: 6px solid #f44336;
            color: #333;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: var(--border-radius);
            font-size: 1.1em;
        }
        
        h1, h2 {
            text-align: center;
            color: var(--text-color);
        }

        /* Home Page Filters */
        .filters {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
            padding: 15px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .filter-btn {
            background-color: #e9ecef;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s;
        }

        .filter-btn:hover {
            background-color: #ced4da;
        }

        .filter-btn.active {
            background-color: var(--primary-color);
            color: white;
        }

        /* Category Cards (Home Page) */
        #results-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .category-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-decoration: none;
            color: var(--text-color);
            transition: transform 0.2s, box-shadow 0.2s;
            border-left: 5px solid; /* Will be colored by JS */
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        .category-card h3 {
            margin: 0 0 10px 0;
        }

        .category-card p {
            margin: 0;
            color: #666;
            text-transform: capitalize;
        }

        /* Standards List (Category Page) */
        .standards-list {
            list-style: none;
            padding: 0;
        }

        .standard-item a {
            display: block;
            background-color: var(--card-bg);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-decoration: none;
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.2em;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .standard-item a:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }
        
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            font-weight: bold;
            color: var(--primary-color);
            text-decoration: none;
        }

    </style>
</head>
<body>

    <div id="app">
        <!-- Dynamic content will be rendered here -->
    </div>

    <script>
        const app = document.getElementById('app');

        /**
         * Fetches the data from the JSON file.
         * @returns {Promise<Object|null>} The parsed JSON data or null on error.
         */
        async function fetchData() {
            try {
                const response = await fetch('data.json');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return await response.json();
            } catch (error) {
                console.error("Error fetching data.json:", error);
                renderError("Could not load the necessary data. Please ensure 'data.json' is available.");
                return null;
            }
        }

        /**
         * Renders an error message at the top of the page.
         * @param {string} message - The error message to display.
         */
        function renderError(message) {
            const errorContainer = document.createElement('div');
            errorContainer.id = 'error-container';
            errorContainer.innerHTML = `<p><strong>Error:</strong> ${message}</p>`;
            // Prepend to the app container
            if (app.firstChild) {
                app.insertBefore(errorContainer, app.firstChild);
            } else {
                app.appendChild(errorContainer);
            }
        }

        /**
         * Renders the home page with filters and all categories.
         * @param {Object} data - The entire dataset.
         */
        function renderHomePage(data) {
            document.body.style.backgroundColor = 'var(--bg-color)';
            
            // Clear existing content except for errors
            const existingError = document.getElementById('error-container');
            app.innerHTML = '';
            if (existingError) {
                app.appendChild(existingError);
            }
            
            const uniqueSubjects = ['All', ...new Set(Object.values(data).map(item => item.subject))];
            const uniqueYears = ['All', ...new Set(Object.values(data).map(item => item.year).sort())];

            // Create filter UI
            const filterContainer = document.createElement('div');
            filterContainer.className = 'filters';
            filterContainer.innerHTML = `
                <div>
                    <strong>Subject:</strong>
                    ${uniqueSubjects.map(subject => `<button class="filter-btn" data-filter-type="subject" data-filter-value="${subject}">${subject}</button>`).join('')}
                </div>
                <div>
                    <strong>Level:</strong>
                    ${uniqueYears.map(year => `<button class="filter-btn" data-filter-type="year" data-filter-value="${year}">${year}</button>`).join('')}
                </div>
            `;
            
            app.appendChild(filterContainer);

            const resultsContainer = document.createElement('div');
            resultsContainer.id = 'results-container';
            app.appendChild(resultsContainer);
            
            let activeFilters = { subject: 'All', year: 'All' };
            
            const displayResults = () => {
                resultsContainer.innerHTML = '';
                Object.entries(data).forEach(([key, category]) => {
                    const subjectMatch = activeFilters.subject === 'All' || category.subject === activeFilters.subject;
                    const yearMatch = activeFilters.year === 'All' || category.year === activeFilters.year;
                    
                    if (subjectMatch && yearMatch) {
                        const card = document.createElement('a');
                        card.href = `/${key}`;
                        card.className = 'category-card';
                        card.style.borderLeftColor = category.color;
                        card.innerHTML = `
                            <h3>${category.title}</h3>
                            <p>${category.subject} - Level ${category.year}</p>
                        `;
                        resultsContainer.appendChild(card);
                    }
                });
            };

            filterContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('filter-btn')) {
                    const { filterType, filterValue } = e.target.dataset;
                    activeFilters[filterType] = filterValue;

                    // Update button active states
                    document.querySelectorAll(`.filter-btn[data-filter-type="${filterType}"]`).forEach(btn => btn.classList.remove('active'));
                    e.target.classList.add('active');

                    displayResults();
                }
            });

            // Set initial active buttons and display results
            document.querySelector('.filter-btn[data-filter-type="subject"][data-filter-value="All"]').classList.add('active');
            document.querySelector('.filter-btn[data-filter-type="year"][data-filter-value="All"]').classList.add('active');
            displayResults();
        }

        /**
         * Renders the page for a specific category (e.g., P3).
         * @param {Object} categoryData - The data object for a single category.
         */
        function renderCategoryPage(categoryData) {
            app.innerHTML = '';
            document.body.style.backgroundColor = categoryData.color;
            
            const title = document.createElement('h1');
            title.textContent = categoryData.title;

            const backLink = document.createElement('a');
            backLink.href = '/';
            backLink.className = 'back-link';
            backLink.textContent = 'â€¹ Back to All Subjects';

            const list = document.createElement('ul');
            list.className = 'standards-list';

            categoryData.pages.forEach(page => {
                const listItem = document.createElement('li');
                listItem.className = 'standard-item';
                listItem.innerHTML = `<a href="${page.url}" target="_blank" rel="noopener noreferrer">${page.title}</a>`;
                list.appendChild(listItem);
            });
            
            app.appendChild(backLink);
            app.appendChild(title);
            app.appendChild(list);
        }

        /**
         * Handles paths that could be a specific standard and redirects if valid.
         * @param {string} path - The URL path segment.
         * @param {Object} data - The entire dataset.
         * @returns {boolean} - True if a redirect occurred, false otherwise.
         */
        function handleStandardRedirect(path, data) {
            // Path could be P3.3 or P2.EXT
            const parts = path.split('.');
            if (parts.length < 2) return false;

            const categoryKey = parts[0];
            const pageId = parts.slice(1).join('.'); // Re-join in case id has dots
            
            const category = data[categoryKey];
            if (category) {
                const page = category.pages.find(p => p.id.toUpperCase() === pageId);
                if (page) {
                    window.location.href = page.url;
                    return true;
                }
            }
            return false;
        }

        /**
         * Main router function to decide what to render.
         */
        async function main() {
            const data = await fetchData();
            if (!data) return; // Stop execution if data failed to load

            // Get path, remove leading slash, and convert to uppercase for consistency
            const path = window.location.pathname.slice(1).toUpperCase();
            
            // Route 1: Specific standard redirect (e.g., /P3.3)
            if (path.includes('.')) {
                if (handleStandardRedirect(path, data)) {
                    return; // Redirect is happening, stop further rendering
                } else {
                    renderError(`The standard '${path}' could not be found.`);
                    renderHomePage(data);
                    return;
                }
            }

            // Route 2: Root URL (show home page)
            if (path === '') {
                renderHomePage(data);
                return;
            }

            // Route 3: Category page (e.g., /P3)
            if (data[path]) {
                renderCategoryPage(data[path]);
                return;
            }

            // Route 4: Invalid path (show error and home page)
            renderError(`The page or category '${path}' does not exist.`);
            renderHomePage(data);
        }

        // Run the application
        main();
    </script>
</body>
</html>
