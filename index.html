<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Adobe Fonts - should be fine here -->
    <link rel="stylesheet" href="https://use.typekit.net/ctk0oqa.css">
    <!-- Font Awesome for icons -->
    <script src="https://kit.fontawesome.com/635c80d725.js" crossorigin="anonymous"></script>
    <title>sciPAD Answers</title>
    <style>
        :root {
            --bg-color: #f4f4f9;
            --text-color: #333;
            --primary-color: #007bff;
            --card-bg: #ffffff;
            --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
        }

        body {
            font-family: 'proxima-nova', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            transition: background-color 0.5s ease;
        }

        #app {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Error Message */
        #error-container {
            background-color: #ffdddd;
            border-left: 6px solid #f44336;
            color: #333;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: var(--border-radius);
            font-size: 1.1em;
        }

        h1,
        h2 {
            text-align: center;
            color: var(--text-color);
        }

        /* Home Page Filters */
        .filters {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            padding: 20px;
            background-color: var(--card-bg);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filters label {
            font-weight: bold;
        }

        .filters select {
            padding: 8px 12px;
            font-size: 1rem;
            border-radius: var(--border-radius);
            border: 1px solid #ced4da;
            background-color: #fff;
            cursor: pointer;
        }

        /* Category Cards (Home Page) */
        #results-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }

        .category-card {
            background-color: var(--card-bg);
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-decoration: none;
            color: var(--text-color);
            transition: transform 0.2s, box-shadow 0.2s;
            border-left: 5px solid;
            /* Will be colored by JS */
        }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
        }

        .category-card h3 {
            margin: 0 0 10px 0;
        }

        .category-card p {
            margin: 0;
            color: #666;
            text-transform: capitalize;
        }

        /* Standards List (Category Page) */
        .standards-list {
            list-style: none;
            padding: 0;
        }

        .standard-item a {
            display: block;
            background-color: var(--card-bg);
            padding: 20px;
            margin-bottom: 15px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            text-decoration: none;
            color: var(--primary-color);
            font-weight: bold;
            font-size: 1.2em;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .standard-item a:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            font-weight: bold;
            color: var(--primary-color);
            text-decoration: none;
        }

        #footer {
            position: fixed;
            left: 0px;
            bottom: 0px;
            height: 60px;
            width: 100%;
            background: whitesmoke;
            padding-bottom: 5px;
            font-size: 0.8em;
        }
    </style>
</head>

<body>
    <div id="app"></div>
    <div id="footer">
        <p style="text-align:center; color: black; line-height: 30px; margin:0;">This site is not affiliated with
            Silverback Academic Media or the official Scipad books. We do not host or distribute Scipad content.
            Scipad is a registered trademark of Silverback Academic Media and is referenced here under fair use for
            identification purposes only. <a href="/about">Learn about our mission.</a></p>
    </div>

    <script>
        const app = document.getElementById('app');

        async function fetchData() {
            try {
                const response = await fetch('data.json');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error("Error fetching data.json:", error);
                renderError("Could not load the necessary data. Please ensure 'data.json' is available.");
                return null;
            }
        }

        function renderError(message) {
            const errorContainer = document.createElement('div');
            errorContainer.id = 'error-container';
            errorContainer.innerHTML = `<p><strong>Error:</strong> ${message}</p>`;
            if (app.firstChild) app.insertBefore(errorContainer, app.firstChild);
            else app.appendChild(errorContainer);
        }

        function renderHomePage(data) {
            document.body.style.backgroundColor = 'var(--bg-color)';
            const existingError = document.getElementById('error-container');
            app.innerHTML = '';
            if (existingError) app.appendChild(existingError);

            const filterContainer = document.createElement('div');
            filterContainer.className = 'filters';
            filterContainer.innerHTML = `
                <div class="filter-group">
                    <label for="subject-select">Subject:</label>
                    <select id="subject-select"></select>
                </div>
                <div class="filter-group">
                    <label for="level-select">Level:</label>
                    <select id="level-select"></select>
                </div>
            `;
            app.appendChild(filterContainer);

            const resultsContainer = document.createElement('div');
            resultsContainer.id = 'results-container';
            app.appendChild(resultsContainer);

            let activeFilters = { subject: 'All', year: 'All' };
            const allCategories = Object.values(data);
            const subjectSelect = document.getElementById('subject-select');
            const levelSelect = document.getElementById('level-select');

            function updateAndRender() {
                const availableBasedOnYear = allCategories.filter(cat => activeFilters.year === 'All' || cat.year === activeFilters.year);
                const availableBasedOnSubject = allCategories.filter(cat => activeFilters.subject === 'All' || cat.subject === activeFilters.subject);

                const availableSubjects = ['All', ...new Set(availableBasedOnYear.map(cat => cat.subject))];

                // *** THIS IS THE CORRECTED LINE ***
                // First, create an array from the Set, then sort it.
                const uniqueLevels = [...new Set(availableBasedOnSubject.map(cat => cat.year))].sort();
                const availableLevels = ['All', ...uniqueLevels];

                populateSelect(subjectSelect, availableSubjects, activeFilters.subject);
                populateSelect(levelSelect, availableLevels, activeFilters.year);

                resultsContainer.innerHTML = '';
                Object.entries(data).forEach(([key, category]) => {
                    const subjectMatch = activeFilters.subject === 'All' || category.subject === activeFilters.subject;
                    const yearMatch = activeFilters.year === 'All' || category.year === activeFilters.year;

                    if (subjectMatch && yearMatch) {
                        const card = document.createElement('a');
                        card.href = `/${key}`;
                        card.className = 'category-card';
                        card.style.borderLeftColor = category.color;
                        card.innerHTML = `
                            <h3>${category.title}</h3>
                            <p>${category.subject} - Level ${category.year}</p>
                        `;
                        resultsContainer.appendChild(card);
                    }
                });
            }

            function populateSelect(selectElement, options, selectedValue) {
                const currentValue = selectElement.value;
                selectElement.innerHTML = '';
                options.forEach(option => {
                    const optionElement = document.createElement('option');
                    optionElement.value = option;
                    optionElement.textContent = option;
                    selectElement.appendChild(optionElement);
                });
                if (options.includes(currentValue)) {
                    selectElement.value = currentValue;
                } else {
                    selectElement.value = selectedValue;
                }
            }

            subjectSelect.addEventListener('change', (e) => {
                activeFilters.subject = e.target.value;
                updateAndRender();
            });

            levelSelect.addEventListener('change', (e) => {
                activeFilters.year = e.target.value;
                updateAndRender();
            });

            updateAndRender();
        }

        function renderCategoryPage(categoryData) {
            app.innerHTML = '';
            document.body.style.backgroundColor = categoryData.color;
            app.innerHTML = `
                <a href="/" class="back-link">â€¹ Back to All Subjects</a>
                <h1>${categoryData.title}</h1>
                <ul class="standards-list">
                    ${categoryData.pages.map(page => `
                        <li class="standard-item">
                            <a href="${page.url}" target="_blank" rel="noopener noreferrer">${page.title}</a>
                        </li>
                    `).join('')}
                </ul>
            `;
        }

        function handleStandardRedirect(path, data) {
            const parts = path.split('.');
            if (parts.length < 2) return false;

            const categoryKey = parts[0];
            const pageId = parts.slice(1).join('.');

            const category = data[categoryKey];
            if (category) {
                const page = category.pages.find(p => p.id.toUpperCase() === pageId);
                if (page) {
                    window.location.href = page.url;
                    return true;
                }
            }
            return false;
        }

        async function main() {
            const data = await fetchData();
            if (!data) return;

            const path = window.location.pathname.slice(1).toUpperCase();

            if (path.includes('.')) {
                if (handleStandardRedirect(path, data)) {
                    return;
                } else {
                    renderError(`The standard '${path}' could not be found.`);
                    renderHomePage(data);
                    return;
                }
            }

            if (path === '') {
                renderHomePage(data);
                return;
            }

            if (data[path]) {
                renderCategoryPage(data[path]);
                return;
            }

            renderError(`The page or category '${path}' does not exist.`);
            renderHomePage(data);
        }

        main();
    </script>
</body>

</html>